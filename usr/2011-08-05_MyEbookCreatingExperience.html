<!DOCTYPE html>
<html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<head>
<title>电子书相关的一些经验及记录分享</title>
</head>
<body>

<xmp theme="united" style="display:none;">

## 自己制作电子书的一些经验分享

**缘起:** 买了K3快一年了，从最初的菜鸟变成现在的老菜鸟，还是有一点点变异心得的，不敢私藏，分享一下

### Kindle 3 调整
- Kindle 3 这个东东吧，新机器要变成可用的机器
- 首先得把系统编码调整为中文，不晓得怎么弄的童鞋，去论坛搜搜帖子，代码摘要如下:

````shell
;debugOn
~changeLocale zh-TW.utf8
;debugOff
````

- 或

````shell
;debugOn
~changeLocale zh-CN
;debugOff
````

- 然后看中文文件，就不会全是圈圈了
- 然后你可以直接用原版系统，或者装多看、越狱
- 偶喜欢原版，所以一直坚持在用
- 中文txt会出现读一半，它不让你读的状况，蛋疼...
- 于是只好转换一个格式...，查了一下，K3支持的格式有mobi(prc)，PDF(6寸)，额转吧
- 好了，现在正题来了

### 老马的工具
- 分享一个网站(老马的原创空间) http://www.comicer.com/stronghorse/software/index.htm
- 这位同学貌似是个动漫爱好者，写了不少强大的电子书处理软件，这里推荐TextForever和FreePic2Pdf
  - TextForever是处理Txt文件的强大工具
  - FreePic2Pdf 是将图片批量转化为PDF的工具(在网上可以说没有一款类似的免费工具能超越它)
- 这两款是转换格式的基础软件

### Mobi格式
- 下面说说mobi格式:
  - 这个格式，是一种打包后的特殊网页
  - 要转换为这个格式，可以用官方出的kindlegen程序
  - 可以先将文本转换为UTF-8，然后在文本上加入HTML标签，这就是txt2mobi软件的原理
  - 下载: http://linpinger.github.io/?s=ThisSite_Mobi

### PDF格式
- PDF就不用说了，关键是要生成6寸的，页面大小大概是 6寸PDF: 宽90mm 高117mm
- PDF格式配置大小:260*335
- 生成PDF可以用WPS，Acrobat，虚拟打印机之类的软件，如果装了.net的童鞋可以用这个工具
  - http://bbs.mydoo.cn/thread-12452-1-1.html
  - 搜索 Convert2PDF_v20110213.7z
- 没有装的，偶自己弄了个txt2PDF: http://linpinger.github.io/?s=ThisSite_PDF

### 图文混排
- 单纯文本文件的解决了，那么图文混排这又是个问题了
- 因为图文混排的来源较复杂，所以处理起来需要不同的方法，这样通用的软件，貌似只有用类似WPS，Acrobat之类的，先编辑好文档，然后转换为PDF

- 偶自己喜欢看小说，所以图文混排很常见，偶有三种转换方案，效果都不错
  - 转mobi格式
    - htm即可，图片就不好弄了，图片是700的宽度，这个将屏幕横过来即可看，但长度有4000-5000，这样mobi格式显示出来的就是整个图片的缩略图，这样就不行了，所以这个图片得来个切割，高度大概是 510-20，20是个区域
    - 这个切割，可以调用Irfanview，或直接使用GDI+来处理，所以这种方式成功，文字效果较好，图片较PDF平滑，勉强可以接受

  - 文字转图片，然后所有图片转PDF
    - 这是没有接触libharu之前的做法，将文本也转换为图片，然后将所有图片转为PDF，文本转图片也用GDI+，可以自定义字体，大小，用irfanview也可以将txt转为图片，不过字体就是记事本的那种字体，不好看

  - 生成图文混排的PDF
    - 这个的技术性就重了一点，不多说了，只能说，免费的将就能用，好用的要钱，自己发布了一个txt2pdf，用的就是用的libhpdf，缺点是用嵌入字体时，只能显示中文，如果有英文，显示的空白，只好将英文字符替换为中文字符，这样有可能造成乱码....，图片就只能嵌入jpg和png，所以gif要转换为PNG格式

- 各位童鞋，还有其他方案吗？

****************

以下记录更新时间: `2015-10-12`

**目的:** 记录 Kindle 修改，备忘

## 设备1: K3 keyboard wifi 黑色
### 记录
- Mem: 256M  ssh登陆进去后free -m 查看的
- 购于2010年吧，2015-10换了一块屏，现在翻页健有点过于灵敏，简称'过敏'
- 很早就jailbreak了，换了字体，屏保，usbnetwork, 中文输入法

****************

## 设备2: K4 none touch 广告版 银灰色
### 记录
- Mem: 256M  ssh登陆进去后free -m 查看的
- 之前由于K3屏损坏，用了一段时间这个，但是按键也时常出故障
- 最近折腾了Openwrt一下，就想ssh登录这个，原来这个自带了这功能，不过需要进调试模式，后来索性jailbreak 装了usbnetwork新版

****************

# 2016-3-16
- K3 挂了，各种重启，各种拔电池，最后好不容易进了系统，发现出现很多问题，例如连接USB，识别为网卡(这个貌似是K4的工程模式用到的，可是这是K3啊)，屏保不见了
- 于是偶 reset to factory了，一夜回到解放前，看着那字体，头都大了，现在怎么越狱也不太记得了，汗
- 当前固件版本: 3.4.2
- 悲剧的是旧版的jailbreak失效了
- 这个记载的无效，原因未知http://wiki.mobileread.com/wiki/Kindle_3_Font_Hack_Lite
- 还是越狱吧: http://www.mobileread.com/forums/showthread.php?t=88004

## 流水
- 版本: kindle-jailbreak-0.13.N.zip/Update_jailbreak_0.13.N_k3w_install.bin
- 版本: kindle-fonts-5.16.N-k3.zip/Update_fonts_5.16.N_k3w_install.bin
  - 神奇了，破解了fonts后，字体变黑了哟，不虚了，那现在还换成兰亭黑咩？
  - 但是为毛浏览器多追加了一个FD的鬼提示，知道了是以前的FreeDownload搞的，怎么卸载是个问题
  - 还有Mobi的第一行的头显示不全是什么鬼
- 版本: kindle-usbnetwork-0.57.N-k3.zip/Update_usbnetwork_0.57.N_k3w_install.bin
  - 装了这玩意儿，然后ssh root@xxx.xxx.xxx.xxx，然后运行FreeDownload的卸载脚本，终于卸载了它
  - 关键还不清楚之前对系统有哪些修改，为毛破解会影响reset to factory的最终结果？难道木有备份分区，直接简单的初始化了一下配置？
  - 装了它，使用现在版的font,ss都卸载了一遍，删除了之前的其他修改
- 2016-3-21: 好了一晚上，待机后使用时，它还是挂了，一直没反应，或者晚上自动重启

# 2016-8-12
- K3 挂了，屏幕完全没显示，能用快捷键调出mp3播放器放歌曲，就是屏幕死都没反应，懒得再修了
- K4 半挂了，屏幕左上角失效，上次送修时，可能快递损坏了，按键有问题，不按都会自动翻页，完全没法用了
- 订了一个 ONYX BOOX c67ML carta，尝试一下非Kindle，期待它的安卓系统，看能不能装自己写的安卓小说阅读器

# 2016-8-17
- 电子书到货了，这两天在修改 foxbook-android 以适应电子书，还真有不少要修改的:背景白色，白色主题，不平滑滚动（翻页），翻页键响应，字体更换，全屏等
- 吐槽一下，这个电子书的安卓是修改了的，桌面是改得面目全非，导致一些莫名其妙的问题，目前foxbook修改后还是可以使用的，不过还有些细节等待完善

# 2016-9-10
- 对这个阅读器还是挺满意的，不过系统还是有些bug，在此记录一下:
- 在顶部的任务栏 A2按钮左边的那个按钮,它的功能是切换两侧翻页键，当图标是 + - 号时，表示切换为音量+ - 键，也就是 KEYCODE_VOLUME_UP  KEYCODE_VOLUME_DOWN,当图标是两个三角时，表示切换为翻页键，也就是 KEYCODE_PAGE_UP      KEYCODE_PAGE_DOWN, 估计是左右按键的发送按键的代码处理有问题
- 右边的按键，按一次，是 KEYCODE_VOLUME_DOWN，按第二次 ，先是 KEYCODE_VOLUME_DOWN，然后是KEYCODE_PAGE_DOWN
- 第一次会聚焦到 ActionBar的控件上，第二次才能扫到keycode，聚焦问题发生在 翻页键模式，音量键模式反而没有这个问题
- ActionBar 隐藏时，会在屏幕顶部遗留一条黑线，应该是 系统改动的这部分没有处理好，在手机等设备上没有这样的现象，推测是定制的系统修改得不怎么完美
- 当从全屏退出到上一个activity时，actionbar显示不正常，表现为actionbar被顶部工具栏覆盖,第二次返回就正常了
- 使用系统字体，前2页会显示比较细(这应该是字体的实际效果)，翻到第3页之后字体会加粗，临时解决办法:将正文字体设置为setFakeBoldText即可
- 时间变动广播: ACTION_TIME_TICK 或 ACTION_TIME_CHANGED 无效，在手机上能正常接收

# 2016-9-14
- 还在修改自己的应用，现在基本上满足了该电子书的需求，为自己点个赞，么么哒

# 2017-2-9
- 意外得到一个白色的Kindle 8，红外触摸屏，无背光，底部就一个开关和一个USB接口，其他木有
- 经过前两个Kindle的折腾，总结下来对它的要求只是要求字体好看，不想再越狱，然而系统自带的字体真不咋样，老外做的产品对国人总是不那么友好
- 搜到文章可以不越狱换字体，https://kindlefere.com/post/426.html
- 一种是在根目录建fonts目录，将字体放进去，mobi中使用css来调用字体显示，此处需要字体真名，优点是可减小mobi体积，浏览器网页代码也可调用该字体显示，缺点是要将字体跟mobi一起发布，而且mobi中无法切换回系统默认字体
- 一种是在mobi中内置字体，优点是可以在mobi中切换，缺点就是体积太大
- 吐槽一下该型号的kindle，相同的字体感觉在K3中显示最好，K4其次，K8有点淡了，另外那个屏幕灰扑扑的，对比白色外壳，那真是黯淡无光
- mobi的导航，以及导航的中文支持，内外置字体需要新版的kindlegen才能正常使用，目前使用V2.9，旧版的不是字体不生效，就是导航乱码
- 新版起点epub转mobi已经放出源码了，见下载工具菜单

# 2017-3-1
- 发现mobi的显示效果与阅读器版本，Kindlegen版本都有关系，真TM复杂
- 同一个源，用V2.9的kindlegen转出来，放到Kindle8中，显示正常，放到Kindle5中，字体惨不忍睹
- 用Kindlegen V1.2转出来，K8书名乱码，目录乱码，Kindle5中标题字体又变得特大
- 所以发现各种奇怪问题，第一更换kindlegen版本试试，第二才是调整各转换参数，头都大了

# 2017-5-31
- 找到onyx 全刷的库，反编译获取到全刷代码，加入到foxbook-android中，具体见该项目README文件

</xmp>

<script src="http://strapdownjs.com/v/0.2/strapdown.js"></script>

<div class="AD" align="center"><script src="http://s14.cnzz.com/stat.php?id=3279032&web_id=3279032&online=1&show=line" language="JavaScript"></script></div>

</body>
</html>
